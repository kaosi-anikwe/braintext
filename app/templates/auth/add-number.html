{% extends "base.html" %} {% block app_content %}
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='assets/css/add_number.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='assets/css/loading.css') }}"
/>
<link
  rel="stylesheet"
  type="text/css"
  href="//cdn.jsdelivr.net/gh/loadingio/ldbutton@v1.0.1/dist/ldbtn.min.css"
/>
<div class="position-absolute top-0 end-0" style="padding-top: 5rem">
  <div
    class="align-items-center text-white bg-success border-0"
    id="resent-toast"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
    hidden
  >
    <div class="d-flex">
      <div class="toast-body">OTP Resent. Check your inbox.</div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
  <div
    class="align-items-center text-white bg-danger border-0"
    id="error-toast"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
    hidden
  >
    <div class="d-flex">
      <div class="toast-body">
        This number has already been used to verify another account.
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
        aria-label="Close"
      ></button>
    </div>
  </div>
</div>

<main id="main" class="main">
  <div class="center-title">
    <div class="pagetitle">
      <h1>Profile</h1>
    </div>
  </div>
  <!-- End Page Title -->
  <section class="section">
    <!-- Add Number section -->
    <div class="row" id="add-number-row">
      <div class="centralize" style="display: flex">
        <div class="col-lg-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title" style="padding: 1rem 0">
                Add WhatsApp Number
              </h5>

              <!-- Vertical Form -->
              <form class="row g-3" id="number-form">
                <div class="col-12">
                  <input
                    id="whatsapp-phone"
                    type="tel"
                    required
                    class="form-control"
                    name="phone"
                  />
                </div>

                <div class="text-center">
                  <button
                    type="submit"
                    id="verify-number"
                    class="btn btn-primary ld-ext-right"
                  >
                    Submit
                    <div class="ld ld-ring ld-spin"></div>
                  </button>
                </div>
              </form>
              <!-- Vertical Form -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Verify Number section -->
    <div class="row" id="verify-otp-row" hidden>
      <div class="centralize" style="display: flex">
        <div class="col-lg-6">
          <div class="card">
            <div class="card-body">
              <h5
                id="enter-code"
                class="card-title"
                style="padding: 1rem 1rem; text-align: center; font-size: 20px"
              >
                Enter verification code sent to +2349032348792
              </h5>
              <h6 id="invalid" hidden class="card-title" style="color: red">
                Invalid code.
              </h6>
              <h6 id="expired" hidden class="card-title" style="color: red">
                OTP has expired, please request another.
              </h6>
              <!-- Vertical Form -->
              <form class="row g-3" id="verify-otp-form">
                <div
                  style="
                    padding-right: 2rem;
                    padding-left: 2rem;
                    display: flex;
                    min-width: 100%;
                    margin: 1rem auto;
                  "
                  class="ap-otp-inputs"
                  data-username="otibij"
                  data-channel="email"
                  data-nonce="0-8bf87e338f"
                  data-length="6"
                  data-form="registration"
                >
                  <input
                    class="ap-otp-input"
                    type="tel"
                    maxlength="1"
                    data-index="0"
                  /><input
                    class="ap-otp-input"
                    type="tel"
                    maxlength="1"
                    data-index="1"
                  /><input
                    class="ap-otp-input"
                    type="tel"
                    maxlength="1"
                    data-index="2"
                  /><input
                    class="ap-otp-input"
                    type="tel"
                    maxlength="1"
                    data-index="3"
                  /><input
                    class="ap-otp-input"
                    type="tel"
                    maxlength="1"
                    data-index="4"
                  /><input
                    class="ap-otp-input"
                    type="tel"
                    maxlength="1"
                    data-index="5"
                  />
                </div>
                <div class="container" style="padding-top: 1rem">
                  <div
                    class="centralize"
                    style="
                      display: flex;
                      justify-content: space-between;
                      text-align: center;
                      font-size: smaller;
                      width: 90%;
                      margin: 0 auto;
                    "
                  >
                    <div class="ld-ext-right">
                      <a
                        id="resend-btn"
                        style="
                          cursor: pointer;
                          font-size: 0.75rem;
                          text-decoration: underline;
                        "
                      >
                        Resend OTP
                      </a>
                      <div class="ld ld-ring ld-spin"></div>
                    </div>

                    <a
                      id="change-number"
                      style="
                        cursor: pointer;
                        font-size: 0.75rem;
                        text-decoration: underline;
                      "
                    >
                      Not your number? Change number
                    </a>
                  </div>
                </div>

                <div class="text-center">
                  <button
                    type="submit"
                    id="verify-otp-submit-btn"
                    class="btn btn-primary ld-ext-right"
                  >
                    Submit
                    <div class="ld ld-ring ld-spin"></div>
                  </button>
                </div>
              </form>
              <!-- Vertical Form -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- End #main -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script>
  var csrfToken = "{{ csrf_token() }}";
</script>
{% if reverify %}
<script>
  const numberInput = document.getElementById("whatsapp-phone");
  numberInput.value = "{{ current_user.phone_no }}";
  var reverify = "{{ reverify }}";
  reverify === "True" ? (reverify = true) : (reverify = false);
</script>
{% endif %}
<script src="{{ url_for('static', filename='assets/js/add_number.js') }}"></script>
{% if reverify %}
<script>
  const submitBtn = document.getElementById("verify-number");
  const sleep = (milliseconds) => {
    return new Promise((resolve) => setTimeout(resolve, milliseconds));
  };
  const send = async () => {
    await sleep(3000);
    numberInput.value = phoneInput.getNumber();
    submitBtn.click();
  };
  window.onload = () => {
    send();
  };
</script>
{% endif %} {% endblock %}
